(()=>{"use strict";var e={804:(e,t,s)=>{var n=s(618),o=s(205),i=s(191),a=s(516),r=s(981);(e.exports=function(e,t){var s,o,d,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],n(e)?(s=r.call(e,"c"),o=r.call(e,"e"),d=r.call(e,"w")):(s=d=!0,o=!1),c={value:t,configurable:s,enumerable:o,writable:d},l?i(a(l),c):c}).gs=function(e,t,s){var d,l,c,h;return"string"!=typeof e?(c=s,s=t,t=e,e=null):c=arguments[3],n(t)?o(t)?n(s)?o(s)||(c=s,s=void 0):s=void 0:(c=t,t=s=void 0):t=void 0,n(e)?(d=r.call(e,"c"),l=r.call(e,"e")):(d=!0,l=!1),h={get:t,set:s,configurable:d,enumerable:l},c?i(a(c),h):h}},430:e=>{e.exports=function(){}},191:(e,t,s)=>{e.exports=s(560)()?Object.assign:s(346)},560:e=>{e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},346:(e,t,s)=>{var n=s(103),o=s(745),i=Math.max;e.exports=function(e,t){var s,a,r,d=i(arguments.length,2);for(e=Object(o(e)),r=function(n){try{e[n]=t[n]}catch(e){s||(s=e)}},a=1;a<d;++a)n(t=arguments[a]).forEach(r);if(void 0!==s)throw s;return e}},914:(e,t,s)=>{var n=s(430)();e.exports=function(e){return e!==n&&null!==e}},103:(e,t,s)=>{e.exports=s(446)()?Object.keys:s(137)},446:e=>{e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},137:(e,t,s)=>{var n=s(914),o=Object.keys;e.exports=function(e){return o(n(e)?Object(e):e)}},516:(e,t,s)=>{var n=s(914),o=Array.prototype.forEach,i=Object.create;e.exports=function(e){var t=i(null);return o.call(arguments,(function(e){n(e)&&function(e,t){var s;for(s in e)t[s]=e[s]}(Object(e),t)})),t}},290:e=>{e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},745:(e,t,s)=>{var n=s(914);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},981:(e,t,s)=>{e.exports=s(591)()?String.prototype.contains:s(42)},591:e=>{var t="razdwatrzy";e.exports=function(){return"function"==typeof t.contains&&!0===t.contains("dwa")&&!1===t.contains("foo")}},42:e=>{var t=String.prototype.indexOf;e.exports=function(e){return t.call(this,e,arguments[1])>-1}},370:(e,t,s)=>{var n,o,i,a,r,d,l,c=s(804),h=s(290),u=Function.prototype.apply,m=Function.prototype.call,g=Object.create,b=Object.defineProperty,p=Object.defineProperties,f=Object.prototype.hasOwnProperty,k={configurable:!0,enumerable:!1,writable:!0};o=function(e,t){var s,o;return h(t),o=this,n.call(this,e,s=function(){i.call(o,e,s),u.call(t,this,arguments)}),s.__eeOnceListener__=t,this},r={on:n=function(e,t){var s;return h(t),f.call(this,"__ee__")?s=this.__ee__:(s=k.value=g(null),b(this,"__ee__",k),k.value=null),s[e]?"object"==typeof s[e]?s[e].push(t):s[e]=[s[e],t]:s[e]=t,this},once:o,off:i=function(e,t){var s,n,o,i;if(h(t),!f.call(this,"__ee__"))return this;if(!(s=this.__ee__)[e])return this;if("object"==typeof(n=s[e]))for(i=0;o=n[i];++i)o!==t&&o.__eeOnceListener__!==t||(2===n.length?s[e]=n[i?0:1]:n.splice(i,1));else n!==t&&n.__eeOnceListener__!==t||delete s[e];return this},emit:a=function(e){var t,s,n,o,i;if(f.call(this,"__ee__")&&(o=this.__ee__[e]))if("object"==typeof o){for(s=arguments.length,i=new Array(s-1),t=1;t<s;++t)i[t-1]=arguments[t];for(o=o.slice(),t=0;n=o[t];++t)u.call(n,this,i)}else switch(arguments.length){case 1:m.call(o,this);break;case 2:m.call(o,this,arguments[1]);break;case 3:m.call(o,this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),t=1;t<s;++t)i[t-1]=arguments[t];u.call(o,this,i)}}},d={on:c(n),once:c(o),off:c(i),emit:c(a)},l=p({},d),e.exports=t=function(e){return null==e?g(l):p(Object(e),d)},t.methods=r},372:(e,t,s)=>{var n=s(60);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!n(e)}},940:(e,t,s)=>{var n=s(618),o={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(o,typeof e)}},205:(e,t,s)=>{var n=s(372),o=/^\s*class[\s{/}]/,i=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!o.test(i.call(e))}},60:(e,t,s)=>{var n=s(940);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},618:e=>{e.exports=function(e){return null!=e}}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=s(370),t=s.n(e);const n="is not an instance of UIElement.";class o{constructor(e){this.dom=e}add(){for(let e=0;e<arguments.length;e++){const t=arguments[e];if(t instanceof o)this.dom.appendChild(t.dom);else if(Array.isArray(t))for(let e=0;e<t.length;e++){const s=t[e];s instanceof o?this.dom.appendChild(s.dom):console.error("UIElement:",s,n)}else console.error("UIElement:",t,n)}return this}remove(){for(let e=0;e<arguments.length;e++){const t=arguments[e];t instanceof o?this.dom.removeChild(t.dom):console.error("UIElement:",t,n)}return this}clear(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)}setId(e){return this.dom.id=e,this}getId(){return this.dom.id}setClass(e){return this.dom.className=e,this}addClass(e){return this.dom.classList.add(e),this}removeClass(e){return this.dom.classList.remove(e),this}setStyle(e,t){for(let s=0;s<t.length;s++)this.dom.style[e]=t[s];return this}setDisabled(e){return this.dom.disabled=e,this}setTextContent(e){return this.dom.textContent=e,this}getRect(){return this.dom.getBoundingClientRect(),this}}["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"].forEach((function(e){const t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);o.prototype[t]=function(){return this.setStyle(e,arguments),this}})),["KeyUp","KeyDown","MouseOver","MouseOut","Click","DblClick","Change","Input"].forEach((function(e){const t="on"+e;o.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this),!1),this}}));class i extends o{constructor(){super(document.createElement("span"))}}class a extends o{constructor(){super(document.createElement("div"))}}class r extends a{constructor(){super(),this.dom.className="row"}}class d extends a{constructor(){super(),this.dom.className="panel"}}class l extends o{constructor(e,t){super(document.createElement("label")),this.dom.textContent=e,t&&(this.dom.htmlFor=t)}}class c extends i{constructor(e){super(),this.setValue(e)}getValue(){return this.dom.textContent}setValue(e){return void 0!==e&&(this.dom.textContent=e),this}}class h extends o{constructor(e,t){super(document.createElement("a")),this.dom.href=e,this.dom.textContent=t}}class u extends o{constructor(e,t,s){super(document.createElement("input")),this.dom.type=e,this.dom.addEventListener("keydown",(function(e){e.stopPropagation()}),!1),this.setValue(t),this.setTitle(s)}getName(){return this.dom.name}setName(e){return this.dom.name=e,this}getType(){return this.dom.type}setType(e){return this.dom.type=e,this}getValue(){return this.dom.value}setValue(e){return void 0!==e&&(this.dom.value=e),this}getTitle(){return this.dom.title}setTitle(e){return void 0!==e&&(this.dom.title=e),this}readonly(e){return this.dom.readOnly=e,this}}class m extends o{constructor(){super(document.createElement("textarea")),this.dom.spellcheck=!1,this.dom.addEventListener("keydown",(function(e){if(e.stopPropagation(),9===e.keyCode){e.preventDefault();const t=dom.selectionStart;this.dom.value=this.dom.value.substring(0,t)+"\t"+this.dom.value.substring(t),this.dom.selectionStart=t+1,this.dom.selectionEnd=this.dom.selectionStart}}),!1)}getValue(){return this.dom.value}setValue(e){return this.dom.value=e,this}}class g extends o{constructor(){super(document.createElement("select"))}setMultiple(e){return this.dom.multiple=e||!1,this}setOptions(e){const t=this.dom.value;for(;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(const t in e){const s=document.createElement("option");s.value=t,s.innerHTML=e[t],this.dom.appendChild(s)}return this.dom.value=t,this}getValue(){return this.dom.value}setValue(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this}}class b extends o{constructor(e,t,s,n){super(document.createElement("input")),this.dom.type="number",this.dom.value=e,null!=t&&(this.dom.step=t),void 0!==s&&(this.dom.min=s),void 0!==n&&(this.dom.max=n)}getValue(){return this.dom.value}setValue(e){return void 0!==e&&(this.dom.value=e),this}}class p extends a{constructor(e){super(),this.tabs=[],this.panels=[],this.selector=(new i).setClass("tab-selector"),this.tabsDiv=new a,this.tabsDiv.dom.className="tabs",this.tabsDiv.add(this.selector),this.panelsDiv=new a,this.panelsDiv.dom.className="panels",this.add(this.tabsDiv),this.add(this.panelsDiv),this.align=e||"horizontal",this.selected=""}select(e){let t,s;if(this.selected&&this.selected.length&&(t=this.tabs.find((e=>e.dom.id===this.selected)),s=this.panels.find((e=>e.dom.id===this.selected)),t&&t.removeClass("selected"),s&&s.setDisplay("none")),t=this.tabs.find((function(t){return t.dom.id===e})),s=this.panels.find((function(t){return t.dom.id===e})),t){let e;t.addClass("selected");const s=t.dom.getBoundingClientRect();"horizontal"===this.align?(e=s.width*this.tabs.indexOf(t),this.selector.dom.style.transform=`translateX(${e}px)`):(e=s.height*this.tabs.indexOf(t),this.selector.dom.style.transform=`translateY(${e}px)`)}return s&&s.setDisplay(""),this.selected=e,this}addTab(e,t,s){const n=new f(t,this);n.setId(e),n.setClass("tab"),this.tabs.push(n),this.tabsDiv.add(n);const o=new a;o.setId(e),o.add(s),o.setDisplay("none"),this.panels.push(o),this.panelsDiv.add(o),this.select(e)}}class f extends a{constructor(e,t){super(e),this.button=new u("button"),this.button.dom.title=e,this.parent=t,this.dom.addEventListener("click",(()=>{this.parent.select(this.dom.id)})),this.add(this.button)}}class k extends o{constructor(){super(document.createElement("ul"))}}class v extends o{constructor(e,t,s){super(document.createElement("li")),this.dom.id=e,this.link=t,this.parent=s,this.toggle=(new i).setClass("toggle-collapsed"),this.expander=(new a).setId("expander"),this.expanded=!1,this.selected=!1,this.add([this.expander,this.link])}setItems(e){if(this.add(e),this.toggle.dom.onclick=()=>(this.expanded?this.collaps():this.expand(),!1),this.expander.add(this.toggle),!this.expanded){const t=e.dom.getElementsByTagName("li");for(let e of t)if("selected"===e.className){this.expand();break}}}select(){this.selected=!0,this.setClass("selected")}unselect(){this.selected=!1,this.dom.removeAttribute("class")}expand(){this.toggle.setClass("toggle-expanded"),this.dom.children[2].style.display="block",this.expanded=!0}collaps(){this.toggle.setClass("toggle-collapsed"),this.dom.children[2].style.display="none",this.expanded=!1}}class w extends d{constructor(e){super(),super.setId("metadata"),this.title=(new c).setId("book-title"),this.creator=(new c).setId("book-creator"),this.separator=(new c).setId("book-title-separator"),super.add([this.title,this.separator,this.creator]),e.on("metadata",(e=>{this.init(e)}))}init(e){document.title=e.title+" – "+e.creator,this.title.setValue(e.title),this.creator.setValue(e.creator),this.separator.dom.style.display="inline-block"}}class y{constructor(e){const t=e.strings,s=(new a).setId("toolbar"),n=(new d).setId("start"),o=new u("button").setId("btn-s"),i=t.get("toolbar/opener");o.dom.title=i,o.dom.onclick=()=>{const t=o.dom.classList.length>0;e.emit("sidebaropener",!t),t?o.removeClass("open"):o.addClass("open")},n.add(o);const r=new w(e),l=(new d).setId("end"),c=new u("button").setId("btn-b"),h=t.get("toolbar/bookmark");c.dom.title=h,c.dom.addEventListener("click",(()=>{const t=e.rendition.currentLocation().start.cfi;e.emit("bookmarked",-1===e.isBookmarked(t))})),l.add(c);const m=new u("button").setId("btn-f");m.dom.title="X",m.dom.addEventListener("click",(()=>{alert("close the issue"),purple.closeView()})),l.add(m),s.add([n,r,l]),document.body.appendChild(s.dom),e.on("relocated",(t=>{const s=t.start.cfi;-1===e.isBookmarked(s)?c.removeClass("bookmarked"):c.addClass("bookmarked")})),e.on("bookmarked",(e=>{e?c.addClass("bookmarked"):c.removeClass("bookmarked")}))}}class x extends d{constructor(e){super(),super.setId("contents"),this.reader=e,this.selector=void 0,e.on("navigation",(e=>{this.init(e)}))}init(e){super.clear(),super.add(this.generateToc(e))}generateToc(e,t){const s=new k;return e.forEach((e=>{const n=new h(e.href,e.label),o=new v(e.id,n,t);n.dom.onclick=()=>(this.reader.rendition.display(e.href),this.selector&&this.selector!==o&&this.selector.unselect(),o.select(),this.selector=o,this.reader.emit("tocselected",e.id),!1),this.reader.settings.sectionId===e.id&&(o.select(),this.selector=o),e.subitems&&e.subitems.length>0&&o.setItems(this.generateToc(e.subitems,o)),s.add(o)})),s}}class C extends d{constructor(e){super(),super.setId("bookmarks");const t=e.strings,s=new r,n=[t.get("sidebar/bookmarks/add"),t.get("sidebar/bookmarks/remove"),t.get("sidebar/bookmarks/clear")],o=new u("button",n[0]).addClass("btn-start"),i=new u("button",n[1]).addClass("btn-medium"),a=new u("button",n[2]).addClass("btn-end");o.dom.onclick=()=>(e.emit("bookmarked",!0),!1),i.dom.onclick=()=>(e.emit("bookmarked",!1),!1),a.dom.onclick=()=>(this.clearBookmarks(),e.emit("bookmarked",!1),!1),s.add([o,i,a]),this.reader=e,this.bookmarks=document.createElement("ul"),super.add(s),this.dom.appendChild(this.bookmarks);const d=()=>{i.dom.disabled=0===e.settings.bookmarks.length,a.dom.disabled=0===e.settings.bookmarks.length};e.on("bookready",(()=>{e.settings.bookmarks.forEach((e=>{const t=this.createBookmarkItem(e);this.bookmarks.appendChild(t)})),d()})),e.on("relocated",(t=>{const s=t.start.cfi,n=-1===e.isBookmarked(s);o.dom.disabled=!n,i.dom.disabled=n})),e.on("bookmarked",(t=>{const s=e.rendition.currentLocation().start.cfi;t?(this.addBookmark(s),o.dom.disabled=!0):(this.removeBookmark(s),o.dom.disabled=!1),d()}))}addBookmark(e){if(this.reader.isBookmarked(e)>-1)return;const t=this.createBookmarkItem(e);this.bookmarks.appendChild(t),this.reader.settings.bookmarks.push(e)}removeBookmark(e){const t=this.reader.isBookmarked(e);-1!==t&&(this.bookmarks.removeChild(this.bookmarks.childNodes[t]),this.reader.settings.bookmarks.splice(t,1))}clearBookmarks(){for(this.reader.settings.bookmarks=[];this.bookmarks.hasChildNodes();)this.bookmarks.removeChild(this.bookmarks.lastChild)}createBookmarkItem(e){const t=document.createElement("li"),s=document.createElement("a"),n=this.reader.book,o=n.spine.get(e);if(o.index in n.navigation.toc){const e=n.navigation.toc[o.index];t.id=e.id,s.textContent=e.label}else s.textContent=e;return s.href="#"+e,s.onclick=()=>(this.reader.rendition.display(e),!1),t.appendChild(s),t}}class I extends d{constructor(e){super(),super.setId("annotations");const t=e.strings,s=[t.get("sidebar/annotations/add"),t.get("sidebar/annotations/clear")];this.reader=e,this.notes=document.createElement("ul");const n=new m;n.dom.addEventListener("input",(e=>{c()&&e.target.value.length>0?d.dom.disabled=!1:d.dom.disabled=!0}));const o={range:void 0,cfiRange:void 0},i=new r,a=new r,d=new u("button",s[0]).addClass("btn-start");d.dom.disabled=!0,d.dom.onclick=()=>{const t={date:new Date,text:n.getValue(),href:o.cfiRange,uuid:e.uuid()};return e.settings.annotations.push(t),this.add(t),n.setValue(""),d.dom.disabled=!0,!1};const l=new u("button",s[1]).addClass("btn-end");l.dom.disabled=!0,l.dom.onclick=()=>(this.clearNotes(),!1),i.add(n),a.add([d,l]),super.add([i,a]),this.dom.appendChild(this.notes),this.update=()=>{l.dom.disabled=0===e.settings.annotations.length};const c=()=>o.range&&o.range.startOffset!==o.range.endOffset;e.on("bookready",(()=>{e.settings.annotations.forEach((e=>{this.add(e)}))})),e.on("selected",((e,t)=>{o.range=t.range(e),o.cfiRange=e,c()&&n.getValue().length>0?d.dom.disabled=!1:d.dom.disabled=!0})),e.on("unselected",(()=>{d.dom.disabled=!0}))}add(e){const t=document.createElement("li"),s=document.createElement("a"),n=document.createElement("span");s.href="#"+e.href,s.textContent=e.text,s.onclick=()=>(this.reader.rendition.display(e.href),!1),t.id="note-"+e.uuid,t.appendChild(s),n.className="btn-remove",n.onclick=()=>(this.remove(e),!1),t.appendChild(n),this.notes.appendChild(t),this.reader.rendition.annotations.add("highlight",e.href,{},(()=>{}),"note-highlight",{}),this.update()}remove(e){const t=this.reader.settings.annotations.indexOf(e);-1!==t&&(this.notes.removeChild(this.notes.childNodes[t]),this.reader.settings.annotations.splice(t,1),this.reader.rendition.annotations.remove(e.href,"highlight"),this.update())}clearNotes(){const e=this.reader.settings.annotations.length;for(let t=0;t<e;t++)this.remove(this.reader.settings.annotations[t])}}class S extends d{constructor(e){super(),super.setId("search");const t=e.strings;let s;const n=new u("search");n.dom.placeholder=t.get("sidebar/search/placeholder"),n.dom.onsearch=()=>{const e=n.getValue();0===e.length?this.clear():s!==e&&(this.clear(),this.doSearch(e).then((e=>{e.forEach((e=>{this.set(e)}))}))),s=e};const o=new r;o.add(n),super.add(o),this.items=document.createElement("ul"),this.dom.appendChild(this.items),this.reader=e}async doSearch(e){const t=this.reader.book,s=await Promise.all(t.spine.spineItems.map((s=>s.load(t.load.bind(t)).then(s.find.bind(s,e)).finally(s.unload.bind(s)))));return await Promise.resolve([].concat.apply([],s))}set(e){const t=document.createElement("li"),s=document.createElement("a");s.href="#"+e.cfi,s.textContent=e.excerpt,s.onclick=()=>(this.reader.rendition.display(e.cfi),!1),t.appendChild(s),this.items.appendChild(t)}clear(){for(;this.items.hasChildNodes();)this.items.removeChild(this.items.lastChild)}}class E extends d{constructor(e){super(),super.setId("settings");const t=e.strings,s=t.get("sidebar/settings/language"),n=new r,o=(new g).setOptions({en:"English",fr:"French",ja:"Japanese",ru:"Russian"});o.dom.addEventListener("change",(t=>{e.settings.language=t.target.value})),n.add(new l(s)),n.add(o);const i=t.get("sidebar/settings/fontsize"),a=new r,d=new b(100,1);d.dom.onchange=t=>{e.emit("styleschanged",{fontSize:parseInt(t.target.value)})},a.add(new l(i)),a.add(d);const c=t.get("sidebar/settings/spread"),h=new r,m=(new g).setOptions({none:"None",auto:"Auto"});m.dom.onchange=t=>{e.emit("spreadchanged",{mod:t.target.value,min:e.settings.spread.min})},h.add(new l(c)),h.add(m);const p=t.get("sidebar/settings/spread/pagewidth"),f=new r,k=new b(800,1);k.dom.onchange=t=>{e.emit("spreadchanged",{mod:e.settings.spread.mod,min:t.target.value})},f.add(new l(p)),f.add(k);const v=t.get("sidebar/settings/pagination"),w=new r,y=new u("checkbox",!1,v[1]);y.setId("pagination"),y.dom.addEventListener("click",(t=>{e.settings.pagination=t.target.checked,e.generatePagination()})),w.add(new l(v[0],"pagination")),w.add(y),super.add([n,a,h,f]),e.on("bookready",(()=>{o.setValue(e.settings.language)})),e.on("styleschanged",(e=>{d.getValue()!==e.fontSize&&d.setValue(e.fontSize)})),e.on("spreadchanged",(e=>{m.getValue()!==e.mod&&m.setValue(e.mod),k.getValue()!==e.min&&k.setValue(e.min)}))}}class O{constructor(e){const t=e.strings,s=[t.get("sidebar/contents"),t.get("sidebar/bookmarks"),t.get("sidebar/annotations"),t.get("sidebar/search"),t.get("sidebar/settings")];this.toc=new x(e),this.bookmarks=new C(e),this.annotations=new I(e),this.search=new S(e),this.settings=new E(e),this.container=new p("vertical").setId("sidebar"),this.container.addTab("tab-t",s[0],this.toc),this.container.addTab("tab-b",s[1],this.bookmarks),this.container.addTab("tab-n",s[2],this.annotations),this.container.addTab("tab-s",s[3],this.search),this.container.addTab("tab-c",s[4],this.settings),this.container.select("tab-t"),document.body.appendChild(this.container.dom)}}class _{constructor(e){this.main=(new a).setId("content"),this.main.dom.addEventListener("transitionend",(t=>{e.settings.sidebarReflow&&e.rendition.resize()}));const t=(new a).setId("prev").setClass("arrow");t.dom.onclick=t=>{e.emit("prev"),t.preventDefault()},t.add(new l("<"));const s=(new a).setId("next").setClass("arrow");s.dom.onclick=t=>{e.emit("next"),t.preventDefault()},s.add(new l(">"));const n=(new a).setId("viewer"),o=(new a).setId("divider"),i=(new a).setId("loader"),r=()=>{o.dom.style.display="block"};this.main.add([t,n,s,o,i]),this.reader=e,document.body.appendChild(this.main.dom),e.on("bookloaded",(()=>{i.dom.style.display="none",e.book.settings.spreads&&r()})),e.on("sidebaropener",(e=>{e?this.slideOut():this.slideIn()})),e.on("layout",(e=>{!0===e.spread&&e.width>e.spreadWidth?r():o.dom.style.display="none"})),e.on("relocated",(e=>{e.atStart?t.addClass("disabled"):t.removeClass("disabled"),e.atEnd?s.addClass("disabled"):s.removeClass("disabled")})),e.on("prev",(()=>{t.addClass("active"),setTimeout((()=>{t.removeClass("active")}),100)})),e.on("next",(()=>{s.addClass("active"),setTimeout((()=>{s.removeClass("active")}),100)})),e.on("viewercleanup",(()=>{n.clear()}))}slideIn(){this.reader.settings.sidebarReflow,this.main.removeClass("single"),this.main.removeClass("closed")}slideOut(){this.reader.settings.sidebarReflow?this.main.addClass("single"):this.main.addClass("closed")}}class B{constructor(e){this.language=e.settings.language||"en",this.values={en:{"toolbar/opener":"Sidebar","toolbar/openbook":"Open book","toolbar/openbook/error":"Your browser does not support the required features.\nPlease use a modern browser such as Google Chrome, or Mozilla Firefox.","toolbar/bookmark":"Add this page to bookmarks","toolbar/fullsceen":"Fullscreen","sidebar/contents":"Contents","sidebar/bookmarks":"Bookmarks","sidebar/bookmarks/add":"Add","sidebar/bookmarks/remove":"Remove","sidebar/bookmarks/clear":"Clear","sidebar/annotations":"Annotations","sidebar/annotations/add":"Add","sidebar/annotations/clear":"Clear","sidebar/annotations/anchor":"Anchor","sidebar/annotations/cancel":"Cancel","sidebar/search":"Search","sidebar/search/placeholder":"search","sidebar/settings":"Settings","sidebar/settings/language":"Language","sidebar/settings/fontsize":"Font size (%)","sidebar/settings/pagination":["Pagination","Generate pagination"],"sidebar/settings/spread":"Spread","sidebar/settings/spread/pagewidth":"Page width"},fr:{"toolbar/opener":"Barre latérale","toolbar/openbook":"Ouvrir un livre local","toolbar/openbook/error":"Votre navigateur ne prend pas en charge les fonctions nécessaires.\nVeuillez utiliser un navigateur moderne tel que Google Chrome ou Mozilla Firefox.","toolbar/bookmark":"Insérer un marque page ici","toolbar/fullsceen":"Plein écran","sidebar/contents":"Sommaire","sidebar/bookmarks":"Marque-pages","sidebar/bookmarks/add":"Ajouter","sidebar/bookmarks/remove":"Retirer","sidebar/bookmarks/clear":"Tout enlever","sidebar/annotations":"Annotations","sidebar/annotations/add":"Ajouter","sidebar/annotations/clear":"Tout enlever","sidebar/annotations/anchor":"Ancre","sidebar/annotations/cancel":"Annuler","sidebar/search":"Rechercher","sidebar/search/placeholder":"rechercher","sidebar/settings":"Réglages","sidebar/settings/language":"Langue","sidebar/settings/fontsize":"???","sidebar/settings/pagination":["Pagination","Établir une pagination"],"sidebar/settings/spread":"???","sidebar/settings/spread/pagewidth":"???"},ja:{"toolbar/opener":"サイドバー","toolbar/openbook":"本を開く","toolbar/openbook/error":"ご利用のブラウザは必要な機能をサポートしていません。\nGoogle Chrome、Mozilla Firefox、その他のモダンなブラウザでご利用ください。","toolbar/bookmark":"このページに栞を設定する","toolbar/fullsceen":"フルスクリーン","sidebar/contents":"目次","sidebar/bookmarks":"栞","sidebar/bookmarks/add":"追加","sidebar/bookmarks/remove":"削除","sidebar/bookmarks/clear":"クリア","sidebar/annotations":"注釈","sidebar/annotations/add":"追加","sidebar/annotations/clear":"クリア","sidebar/annotations/anchor":"アンカー","sidebar/annotations/cancel":"キャンセル","sidebar/search":"検索","sidebar/search/placeholder":"検索","sidebar/settings":"設定","sidebar/settings/language":"表示言語","sidebar/settings/fontsize":"???","sidebar/settings/pagination":["ページネーション","ページネーションを生成します。"],"sidebar/settings/spread":"???","sidebar/settings/spread/pagewidth":"???"},ru:{"toolbar/opener":"Боковая панель","toolbar/openbook":"Открыть книгу","toolbar/openbook/error":"Ваш браузер не поддерживает необходимые функции.\nПожалуйста, используйте современный браузер, такой как Google Chrome или Mozilla Firefox.","toolbar/bookmark":"Добавить эту страницу в закладки","toolbar/fullsceen":"Полноэкранный режим","sidebar/contents":"Содержание","sidebar/bookmarks":"Закладки","sidebar/bookmarks/add":"Добавить","sidebar/bookmarks/remove":"Удалить","sidebar/bookmarks/clear":"Очистить","sidebar/annotations":"Аннотации","sidebar/annotations/add":"Добавить","sidebar/annotations/clear":"Очистить","sidebar/annotations/anchor":"Метка","sidebar/annotations/cancel":"Отмена","sidebar/search":"Поиск","sidebar/search/placeholder":"поиск...","sidebar/settings":"Настройки","sidebar/settings/language":"Язык","sidebar/settings/fontsize":"Размер шрифта","sidebar/settings/pagination":["Нумерация страниц","Генерировать нумерацию страниц"],"sidebar/settings/spread":"Разворот","sidebar/settings/spread/pagewidth":"Ширина страницы"}}}get(e){return this.values[this.language][e]||"???"}}class L{constructor(e,t){this.settings=void 0,this.cfgInit(e,t),this.strings=new B(this),this.toolbar=new y(this),this.sidebar=new O(this),this.content=new _(this),this.book=void 0,this.rendition=void 0,this.displayed=void 0,this.init(),window.addEventListener("beforeunload",this.unload.bind(this),!1),window.addEventListener("hashchange",this.hashChanged.bind(this),!1),window.addEventListener("keydown",this.keyboardHandler.bind(this),!1),window.addEventListener("wheel",(e=>{e.ctrlKey&&e.preventDefault()}),{passive:!1})}init(e,t){this.emit("viewercleanup"),arguments.length>0&&this.cfgInit(e,t),this.book=ePub(this.settings.bookPath),this.rendition=this.book.renderTo("viewer",{width:"100%",height:"100%",allowScriptedContent:!0});const s=this.settings.previousLocationCfi;this.displayed=s?this.rendition.display(s):this.rendition.display(),this.displayed.then((e=>{this.emit("renderered",e)})),this.book.ready.then(function(){this.settings.pagination&&this.generatePagination(),this.emit("bookready"),this.emit("spreadchanged",this.settings.spread),this.emit("styleschanged",this.settings.styles)}.bind(this)).then(function(){this.emit("bookloaded")}.bind(this)),this.book.loaded.metadata.then((e=>{this.emit("metadata",e)})),this.book.loaded.navigation.then((e=>{this.emit("navigation",e)})),this.rendition.on("click",(e=>{const t=e.view.document.getSelection().getRangeAt(0);t.startOffset===t.endOffset&&this.emit("unselected")})),this.rendition.on("layout",(e=>{this.emit("layout",e)})),this.rendition.on("selected",((e,t)=>{this.setLocation(e),this.emit("selected",e,t)})),this.rendition.on("relocated",(e=>{this.setLocation(e.start.cfi),this.emit("relocated",e)})),this.on("prev",(()=>{"rtl"===this.book.package.metadata.direction?this.rendition.next():this.rendition.prev()})),this.on("next",(()=>{"rtl"===this.book.package.metadata.direction?this.rendition.prev():this.rendition.next()})),this.on("tocselected",(e=>{this.settings.sectionId=e})),this.on("spreadchanged",(e=>{this.settings.spread.mod=e.mod,this.settings.spread.min=e.min,this.rendition.spread(e.mod,e.min)})),this.on("styleschanged",(e=>{const t=e.fontSize;this.settings.styles.fontSize=t,this.rendition.themes.fontSize(t+"%")}))}defaults(e){for(let t=1,s=arguments.length;t<s;t++){const s=arguments[t];for(let t in s)void 0===e[t]&&(e[t]=s[t])}return e}uuid(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:7&s|8).toString(16)}))}isBookmarked(e){return this.settings.bookmarks.indexOf(e)}isAnnotated(e){return this.settings.annotations.indexOf(e)}cfgInit(e,t){this.settings=this.defaults(t||{},{bookKey:this.getBookKey(e),bookPath:e,restore:!1,history:!0,reload:!1,bookmarks:void 0,annotations:void 0,contained:void 0,sectionId:void 0,spread:void 0,styles:void 0,pagination:!1,language:void 0}),this.settings.restore&&this.isSaved()&&this.applySavedSettings(),void 0===this.settings.bookmarks&&(this.settings.bookmarks=[]),void 0===this.settings.annotations&&(this.settings.annotations=[]),void 0===this.settings.spread&&(this.settings.spread={mod:"auto",min:800}),void 0===this.settings.styles&&(this.settings.styles={fontSize:100}),void 0===this.settings.language&&(this.settings.language="en")}getBookKey(e){return"epubjs-reader:"+md5(e)}setBookKey(e){return void 0===this.settings.bookKey&&(this.settings.bookKey=this.getBookKey(e)),this.settings.bookKey}isSaved(){return!!localStorage&&null!==localStorage.getItem(this.settings.bookKey)}removeSavedSettings(){return!!this.isSaved()&&(localStorage.removeItem(this.settings.bookKey),!0)}applySavedSettings(){if(!localStorage)return!1;let e;try{e=JSON.parse(localStorage.getItem(this.settings.bookKey))}catch(e){console.exception(e)}return!!e&&(e.spread&&(this.settings.spread=this.defaults(this.settings.spread||{},e.spread)),e.styles&&(this.settings.styles=this.defaults(this.settings.styles||{},e.styles)),this.settings=this.defaults(this.settings,e),!0)}saveSettings(){if(this.book&&this.rendition.location){const e=this.rendition.currentLocation();this.settings.previousLocationCfi=e.start.cfi}return!!localStorage&&(localStorage.setItem(this.settings.bookKey,JSON.stringify(this.settings)),!0)}unload(){this.settings.restore&&localStorage&&this.saveSettings()}hashChanged(){const e=window.location.hash.slice(1);this.rendition.display(e)}setLocation(e){const t=this.book.archived?void 0:this.book.url,s=new URL(window.location,t);s.hash="#"+e,this.settings.history&&window.location.hash!==s.hash&&(window.history.pushState({},"",s),this.currentLocationCfi=e)}generatePagination(){}keyboardHandler(e){if(e.ctrlKey||e.metaKey){const t=2;let s=this.settings.styles.fontSize;switch(e.key){case"=":e.preventDefault(),s+=t,this.emit("styleschanged",{fontSize:s});break;case"-":e.preventDefault(),s-=t,this.emit("styleschanged",{fontSize:s});break;case"0":e.preventDefault(),s=100,this.emit("styleschanged",{fontSize:s})}}else switch(e.key){case"ArrowLeft":this.emit("prev"),e.preventDefault();break;case"ArrowRight":this.emit("next"),e.preventDefault()}}}t()(L.prototype);class D{constructor(){this.name="epubjs-reader",this.version=1,this.database,this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,void 0===this.indexedDB&&alert("The IndexedDB API not available in your browser.")}init(e){if(void 0===this.indexedDB)return void e();const t=this,s=indexedDB.open(this.name,this.version);s.onupgradeneeded=function(e){const t=e.target.result;!1===t.objectStoreNames.contains("entries")&&t.createObjectStore("entries")},s.onsuccess=function(s){t.database=s.target.result,t.database.onerror=function(e){console.error("IndexedDB",e)},e()},s.onerror=function(e){console.error("IndexedDB",e)}}get(e){void 0!==this.database?this.database.transaction(["entries"],"readwrite").objectStore("entries").get(0).onsuccess=function(t){e(t.target.result),console.log("storage.get")}:e()}set(e,t){void 0!==this.database?this.database.transaction(["entries"],"readwrite").objectStore("entries").put(e,0).onsuccess=function(){t(),console.log("storage.set")}:t()}clear(){void 0!==this.database&&(this.database.transaction(["entries"],"readwrite").objectStore("entries").clear().onsuccess=function(){console.log("storage.clear")})}}window.ResizeObserver=void 0,window.onload=function(){const e=new D;e.init((function(){e.get((function(e){void 0!==e&&0===E_BOOK_URL?window.reader=new L(e,{restore:!0}):window.reader=new L(E_BOOK_URL,{restore:!0})}))})),window.storage=e}})()})();
//# sourceMappingURL=epubreader.js.map